{% extends "assignments/base.jinja" %}

{% block title %}Assignments Overview{% endblock %}

{% block content %}
<h1 class="mb-4">Upcoming Deadlines</h1>
<table class="table table-striped table-hover table-dark">
    <thead class="table-dark">
        <tr>
            <th>Time Left</th>
            <th>Due Date</th>
            <th>Points</th>
            <th>Topic</th>
            <th>Course</th>
        </tr>
    </thead>
    <tbody>
        {% for topic in upcoming_topics %}
            {% set is_muted = topic.points != "-" or topic.acknowledged %}
            <tr>
                <td {% if is_muted %}class="text-success"{% endif %}>{{ (topic.deadline - now).days }}d {{ (topic.deadline - now).seconds // 3600 }}h</td>
                <td {% if is_muted %}class="text-success"{% endif %}>{{ topic.deadline.strftime('%Y-%m-%d %H:%M') }}</td>
                <td {% if is_muted %}class="text-success"{% endif %}>{{ topic.points }}/{{ topic.max_points }}</td>
                <td><a href="{{ topic.url }}" class="{% if is_muted %}link-success{%else%}link-light{% endif %}">{{ topic.name }}</a></td>
                <td><a href="{{ topic.course.url }}" class="{% if is_muted %}link-success{%else%}link-light{% endif %}">{{ topic.course.name }}</a></td>
            </tr>
        {% endfor %}
    </tbody>
</table>
<h1 class="mb-4 mt-5">Without Deadlines</h1>
<table class="table table-striped table-hover table-dark">
    <thead class="table-dark">
        <tr>
            <th>Points</th>
            <th>Topic</th>
            <th>Course</th>
        </tr>
    </thead>
    <tbody>
        {% for topic in no_deadline_topics %}
            {% set is_muted = topic.points != "-" or topic.acknowledged %}
            <tr>
                <td {% if is_muted %}class="text-success"{% endif %}>{{ topic.points }}/{{ topic.max_points }}</td>
                <td><a href="{{ topic.url }}" class="{% if is_muted %}link-success{%else%}link-light{% endif %}">{{ topic.name }}</a></td>
                <td><a href="{{ topic.course.url }}" class="{% if is_muted %}link-success{%else%}link-light{% endif %}">{{ topic.course.name }}</a></td>
            </tr>
        {% endfor %}
    </tbody>
</table>
<h1 class="mb-4 mt-5">Old</h1>
<table class="table table-striped table-hover table-dark">
    <thead class="table-dark">
        <tr>
            <th>Time Past</th>
            <th>Due Date</th>
            <th>Points</th>
            <th>Topic</th>
            <th>Course</th>
        </tr>
    </thead>
    <tbody>
        {% for topic in old_topics %}
            {% set is_muted = topic.points != "-" or topic.acknowledged %}
            <tr>
                <td {% if is_muted %}class="text-success"{% endif %}>{{ (topic.deadline - now).days }}d {{ (topic.deadline - now).seconds // 3600 }}h</td>
                <td {% if is_muted %}class="text-success"{% endif %}>{{ topic.deadline.strftime('%Y-%m-%d %H:%M') }}</td>
                <td {% if is_muted %}class="text-success"{% endif %}>{{ topic.points }}/{{ topic.max_points }}</td>
                <td><a href="{{ topic.url }}" class="{% if is_muted %}link-success{%else%}link-light{% endif %}">{{ topic.name }}</a></td>
                <td><a href="{{ topic.course.url }}" class="{% if is_muted %}link-success{%else%}link-light{% endif %}">{{ topic.course.name }}</a></td>
            </tr>
        {% endfor %}
    </tbody>
</table>

<div class="mt-5 mb-4">
    <button class="btn btn-outline-light" type="button" data-bs-toggle="collapse" data-bs-target="#courseFilterCollapse" aria-expanded="false" aria-controls="courseFilterCollapse">
        Course Filter Settings
    </button>
    <div class="collapse mt-3" id="courseFilterCollapse">
        <div class="card card-body bg-dark border-light">
            <h5>Hide Courses</h5>
            <div id="courseCheckboxes">
                {% for course in courses %}
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" value="{{ course.url }}" id="course-{{ loop.index }}">
                    <label class="form-check-label" for="course-{{ loop.index }}">
                        {{ course.name }}
                    </label>
                </div>
                {% endfor %}
            </div>
            <button class="btn btn-primary mt-3" onclick="saveHiddenCourses()">Save Settings</button>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const hiddenCourses = JSON.parse(localStorage.getItem('hiddenCourses') || '[]');
        
        const checkboxes = document.querySelectorAll('#courseCheckboxes input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            if (hiddenCourses.includes(checkbox.value)) {
                checkbox.checked = true;
            }
        });
    });
    
    function saveHiddenCourses() {
        const checkboxes = document.querySelectorAll('#courseCheckboxes input[type="checkbox"]:checked');
        const hiddenCourses = Array.from(checkboxes).map(checkbox => checkbox.value);
        
        localStorage.setItem('hiddenCourses', JSON.stringify(hiddenCourses));
        
        window.location.reload();
    }
</script>

{% endblock %}
